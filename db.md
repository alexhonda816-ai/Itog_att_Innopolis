# Реализация базы данных и CRUD операций для магазина

## Введение

В данном документе представлена реализация слоя доступа к данным (Data Access Layer) для проекта магазина. Этот слой обеспечивает взаимодействие между приложением и базой данных SQLite. Ниже описаны основные функции, обеспечивающие работу с клиентскими данными, информацией о товарах и заказах.

---

## Архитектура

Используя SQLAlchemy или аналогичные ORM было бы удобнее организовать доступ к данным, однако данная реализация выполнена вручную через низкоуровневые запросы к SQLite. Ключевое преимущество такой архитектуры заключается в простоте понимания механизма запросов и управлении структурой базы данных.

Все манипуляции с базой происходят внутри функций, каждая из которых решает одну задачу, будь то получение записей, добавление новой сущности или выполнение агрегационных операций.

---

## Функции уровня доступа к данным

### Функция подключения к базе данных
pythondef get_connection():    
"""Возвращает соединение с базой данных.
"""    return sqlite3.connect(DB_FILE)Подключение осуществляется с помощью стандартного метода sqlite3.connect(), который возвращает объект соединения. Эта функция используется повсеместно для получения текущего состояния базы данных.
---
### Создание таблиц

pythondef create_tables():    
"""Создает таблицы в базе данных, если они ещё не существуют.
"""    ...Эта функция проверяет наличие необходимых таблиц в базе данных и создаёт их, если они отсутствуют. Таблицы создаются один раз при запуске программы, что гарантирует целостность данных и возможность дальнейшей работы с ними.Структура таблиц:- Clients: Хранит информацию о клиентах (идентификатор, имя, электронная почта, номер телефона и адрес).- Products: Информация о товарах (идентификатор, название и цена).- Orders: Данные о заказах (идентификатор, привязанный клиент и дата заказа).- Order_Products: Связующая таблица для связи заказов и товаров (для поддержки отношения многие ко многим).
---
### Операции с сущностями#### Клиенты

pythondef add_client(client):    
"""Добавляет нового клиента в базу данных.
"""    ...Эта функция позволяет добавить новую запись о клиенте в таблицу clients. Она поддерживает уникальность электронных почтовых адресов и предотвращает дублирование пользователей.

pythondef get_all_clients():    
"""Получает список всех клиентов из базы данных.
"""    ...Фунция получает полный список клиентов из базы данных и конвертирует его в объекты типа Client.
---
#### Товары

pythondef add_product(product):    
"""Добавляет новый товар в базу данных.
"""    ...Функция добавления товара аналогична работе с клиентом, позволяет внести новый товар в таблицу products.

pythondef get_all_products():    
"""Получает список всех товаров из базы данных.
"""    ...Позволяет извлечь полный перечень товаров из базы данных и вернуть его в виде списка объектов Product.
---
#### Заказы

pythondef add_order(order):    
"""Добавляет новый заказ в базу данных.
"""    ...Процедура добавления заказа состоит из двух этапов: сначала добавляется сам заказ, потом связываются конкретные товары с ним посредством промежуточной таблицы order_products.

pythondef get_all_orders():    
"""Получает список всех заказов из базы данных.
"""    ...Эту функцию сложнее реализовать, поскольку она требует агрегированных выборок и объединения нескольких таблиц для формирования конечного результата. Результат формируется с учётом наличия конкретных товаров и общего числа позиций в каждом заказе.
---
### Экспорт и импорт данных
#### Экспортация данных в JSON

pythondef export_data_to_json(file_path):    
"""Экспортирует данные клиентов и товаров в JSON-файл.
"""    ...Функция собирает всю информацию о клиентах и товарах и экспортирует её в формат JSON. Это полезно для резервного копирования или передачи данных другим системам.#### Импорт данных из CSV

pythondef import_data_from_csv(file_path):    
"""Импортирует данные клиентов из CSV-файла.
"""    ...Эта функция читает файлы CSV и импортирует информацию о клиентах в базу данных. Каждый элемент проверяется на валидность и создаётся новая запись в базе данных, если информация корректна.---## Тестирование и использованиеКаждая функция оснащена механизмами обработки исключений и сообщений об ошибках, позволяющими контролировать состояние базы данных и избежать критических сбоев.Типичный пример использования API представлен ниже:

Создание клиента
new_client = Client(name="Алексей Петров", email="alexey.petrov@mail.ru", phone="+79111234567", address="г. Москва, ул. Красная площадь, дом 1")
add_client(new_client)

Добавление товара
new_product = Product(name="Кофе растворимый", price=150.0)
add_product(new_product)

Получение всех клиентов
clients = get_all_clients()
for client in clients:    
print(client.to_dict())
---
## Заключение